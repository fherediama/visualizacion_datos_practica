knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(networkD3)
library(tidyverse)
library(scales)
library(plotly)
# Carga
male_players   <- read.csv("../../male_players.csv", stringsAsFactors = FALSE)
female_players <- read.csv("../../female_players.csv", stringsAsFactors = FALSE)
# Añadir columna de género
male_players$gender   <- "Male"
female_players$gender <- "Female"
# Identificar columnas comunes
common_cols <- intersect(names(male_players), names(female_players))
# Union dataframe
all_players <- bind_rows(
male_players %>% select(all_of(common_cols)),
female_players %>% select(all_of(common_cols))
)
df_final <- all_players %>%
# Filtro solo FIFA 24
filter(fifa_version == "24" | fifa_version == 24) %>%
# Filtro ligas principales
filter(league_name %in% c("Premier League", "La Liga", "Bundesliga", "Serie A", "Ligue 1",
"Liga Portugal", "Eredivisie", "MLS", "Saudi Pro League",
"D1 Arkema", "Barclays WSL", "Frauen-Bundesliga", "Liga F", "NWSL")) %>%
# Creación de métricas
mutate(
# Metrica eficiencia salarial
eficiencia_salarial = overall / (wage_eur + 1),
# Metrica indice proyeccion
indice_proyeccion = (potential - overall) / age,
# Metrica gap de mercado
gap_mercado = release_clause_eur - value_eur,
# Agrupación de nivel
overall_tier = case_when(
overall >= 90 ~ "Elite (90+)",
overall >= 85 ~ "Top Class (85-89)",
overall >= 80 ~ "Bueno (80-84)",
overall >= 75 ~ "Medio (75-79)",
TRUE ~ "Bajo (<75)"
),
# Agrupación de Posiciones
general_position = case_when(
club_position %in% c("ST", "CF", "LW", "RW", "LF", "RF", "LS", "RS") ~ "Delantero",
club_position %in% c("CAM", "CM", "CDM", "LM", "RM", "LCM", "RCM") ~ "Centrocampista",
club_position %in% c("CB", "LB", "RB", "LWB", "RWB", "LCB", "RCB") ~ "Defensa",
club_position == "GK" ~ "Portero",
TRUE ~ "Otros"
)
) %>%
# Selección de variables
select(
short_name,          # Nombre
age, height_cm, weight_kg, # Físico
overall, potential,  # Rendimiento
value_eur, wage_eur, release_clause_eur, # Económico
club_name, league_name, club_position, # Contexto
nationality_name, preferred_foot, gender, # Demográfico
eficiencia_salarial, indice_proyeccion, gap_mercado, # Nuevas métricas
general_position, overall_tier # Variables de apoyo
) %>%
# Limpieza de filas vacías clave
filter(!is.na(value_eur), !is.na(wage_eur), !is.na(overall))
write.csv(df_final, "../data/all_players.csv", row.names = FALSE)
# Dataset 1: Posiciones
data_posiciones <- df_final %>%
group_by(general_position) %>%
summarise(
avg_value = round(mean(value_eur, na.rm = TRUE), 0),
avg_wage = round(mean(wage_eur, na.rm = TRUE), 0),
avg_overall = round(mean(overall, na.rm = TRUE), 1),
count = n()
) %>% filter(general_position != "Otros")
write.csv(data_posiciones, "../data/1_posiciones.csv", row.names = FALSE)
# Dataset 2: Ligas/Mapa
data_ligas <- df_final %>%
group_by(league_name) %>%
summarise(
count = n(),
avg_value = round(mean(value_eur, na.rm = TRUE), 0),
avg_wage = round(mean(wage_eur, na.rm = TRUE), 0),
avg_gap = round(mean(gap_mercado, na.rm = TRUE), 0),
avg_eficiencia = mean(eficiencia_salarial, na.rm = TRUE)
)
write.csv(data_ligas, "../data/2_ligas.csv", row.names = FALSE)
# Dataset 3: Género
data_genero <- df_final %>%
filter(overall_tier != "Bajo (<75)") %>%
group_by(overall_tier, gender) %>%
summarise(
avg_wage = round(mean(wage_eur, na.rm = TRUE), 0),
avg_value = round(mean(value_eur, na.rm = TRUE), 0),
gap_salarial = round(mean(gap_mercado, na.rm = TRUE), 0),
count = n(),
.groups = "drop"
)
write.csv(data_genero, "../data/3_genero.csv", row.names = FALSE)
# Dataset 4: Edad
data_edad <- df_final %>%
filter(age <= 38) %>%
group_by(age) %>%
summarise(
avg_potential = round(mean(potential, na.rm = TRUE), 1),
avg_value = round(mean(value_eur, na.rm = TRUE), 0),
avg_wage = round(mean(wage_eur, na.rm = TRUE), 0)
)
write.csv(data_edad, "../data/4_edad.csv", row.names = FALSE)
